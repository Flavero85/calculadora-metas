<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculadora de Metas</title>
    <link rel="manifest" href="manifest.json">
    <style>
        /* --- CSS COMPLETO --- */
:root {
    --primary-color: #1877f2; --primary-color-hover: #166fe5; --secondary-button-bg: #e4e6eb; --secondary-button-hover-bg: #dcdfe3; --background-color: #f0f2f5; --container-background: #ffffff; --text-color: #1c1e21; --text-secondary-color: #606770; --border-color: #ddd; --info-color: #1877f2; --info-background: #e7f3ff; --success-color: #31a24c; --success-background: #e3f3e6;
}
body {
    font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif; background-color: var(--background-color); color: var(--text-color); margin: 0; padding: 20px;
}
.page-container { max-width: 600px; margin: 20px auto; padding: 20px 40px; background-color: var(--container-background); border-radius: 8px; box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1); text-align: center; }
.page-container h1 { color: var(--text-color); margin-bottom: 5px; }
.page-container p { color: var(--text-secondary-color); margin-bottom: 25px; }
.form-group { margin-bottom: 15px; text-align: left; }
.form-group label { display: block; margin-bottom: 5px; font-size: 14px; font-weight: 500; color: var(--text-color); }
.form-group input { width: 100%; padding: 10px; box-sizing: border-box; font-size: 14px; border: 1px solid var(--border-color); border-radius: 6px; background-color: #fdfdfd; }
.button { background-color: var(--primary-color); color: white; padding: 10px 15px; border: none; border-radius: 6px; font-size: 14px; font-weight: bold; cursor: pointer; width: 100%; box-sizing: border-box; }
.secondary-button { background-color: var(--secondary-button-bg); color: var(--text-color); }
.secondary-button:hover { background-color: var(--secondary-button-hover-bg); }
.metric-group { text-align: left; }
.section-divider { border: none; border-top: 1px solid var(--border-color); margin: 25px 0; }
.faixas-container { display: flex; flex-wrap: wrap; gap: 8px; margin-top: 10px; }
.faixa-item { background-color: var(--secondary-button-bg); border: 1px solid var(--border-color); padding: 6px 10px; border-radius: 16px; font-size: 12px; color: var(--text-secondary-color); transition: all 0.3s; }
.faixa-item.achieved { background-color: var(--success-background); border-color: var(--success-color); color: var(--text-color); font-weight: bold; }
#metas-container { margin-top: 25px; text-align: left; }
.meta-item { margin-bottom: 15px; }
.meta-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 5px; font-size: 14px; }
.meta-label { font-weight: 500; }
.meta-percentage { font-weight: bold; color: var(--text-secondary-color); }
.progress-bar-background { width: 100%; height: 20px; background-color: var(--secondary-button-bg); border-radius: 10px; overflow: hidden; border: 1px solid var(--border-color); }
.progress-bar-fill { height: 100%; width: 0%; background-color: var(--info-color); border-radius: 10px; transition: width 0.5s ease-out, background-color 0.5s; }
.progress-bar-fill.completed { background-color: var(--success-color); }
.summary-box { margin-top: 25px; padding: 15px; background-color: var(--info-background); border-left: 5px solid var(--info-color); border-radius: 4px; font-weight: bold; text-align: center; transition: all 0.3s; }
.summary-box.completed { background-color: var(--success-background); border-left-color: var(--success-color); }
.daily-counter { display: flex; justify-content: space-between; align-items: center; background-color: var(--secondary-button-bg); padding: 10px; border-radius: 8px; margin-bottom: 15px; }
.daily-counter-label { display: flex; flex-direction: column; text-align: left; }
.daily-counter-label span { font-size: 12px; color: var(--text-secondary-color); }
.daily-counter-label strong { font-size: 24px; color: var(--primary-color); }
#dailyIncrementButton { width: auto; flex-shrink: 0; padding: 10px 20px; font-size: 1.2rem; }
    </style>
</head>
<body>

    <div class="page-container" style="max-width: 600px;">
        <h1>Calculadora de Metas</h1>
        <p>Acompanhe seu progresso de atendimentos, CSAT e Avaliadas.</p>

        <div class="metric-group">
            <div class="daily-counter">
                <div class="daily-counter-label">
                    <span>Atendimentos de Hoje</span>
                    <strong id="dailyCountDisplay">0</strong>
                </div>
                <button type="button" id="dailyIncrementButton" class="button">+1</button>
            </div>
            <div class="form-group">
                <label for="atendimentosInput">Total de Atendimentos no M√™s:</label>
                <input type="number" id="atendimentosInput" placeholder="Total acumulado...">
            </div>
             <div class="form-group">
                <button type="button" id="saveTotalButton" class="button secondary-button">Salvar Total e Zerar Di√°rio</button>
            </div>
            <div id="metas-container"></div>
            <div id="summary-text" class="summary-box">Aguardando seus dados...</div>
        </div>

        <hr class="section-divider">

        <div class="metric-group">
            <div class="form-group">
                <label for="csatInput">CSAT (%):</label>
                <input type="number" id="csatInput" placeholder="Ex: 85" min="0" max="100">
            </div>
            <div class="faixas-container" id="csatFaixas"></div>
        </div>

        <hr class="section-divider">

        <div class="metric-group">
            <div class="form-group">
                <label for="avaliadasInput">Avaliadas (%):</label>
                <input type="number" id="avaliadasInput" placeholder="Ex: 42" min="0">
            </div>
            <div class="faixas-container" id="avaliadasFaixas"></div>
        </div>
    </div>

    <script>
        // --- JAVASCRIPT COMPLETO ---
document.addEventListener('DOMContentLoaded', () => {
    const metasPageIdentifier = document.getElementById('atendimentosInput');
    if (metasPageIdentifier) {
        
        // --- ELEMENTOS DO DOM ---
        const atendimentosInput = document.getElementById('atendimentosInput');
        const dailyCountDisplay = document.getElementById('dailyCountDisplay');
        const dailyIncrementButton = document.getElementById('dailyIncrementButton');
        const saveTotalButton = document.getElementById('saveTotalButton');
        const metasContainer = document.getElementById('metas-container');
        const summaryText = document.getElementById('summary-text');

        // --- DADOS DAS METAS ---
        const metas = [{ id: 1, target: 550, reward: 300 }, { id: 2, target: 750, reward: 400 }, { id: 3, target: 850, reward: 500 }, { id: 4, target: 950, reward: 700 }];

        // --- FUN√á√ïES DE ATENDIMENTO ---
        function renderAtendimentoMetas() { metasContainer.innerHTML = ''; metas.forEach(meta => { const metaElement = document.createElement('div'); metaElement.className = 'meta-item'; metaElement.innerHTML = `<div class="meta-header"><span class="meta-label">Faixa ${meta.id}: ${meta.target} (R$ ${meta.reward})</span><span class="meta-percentage" id="meta${meta.id}-percent">0%</span></div><div class="progress-bar-background"><div class="progress-bar-fill" id="meta${meta.id}-fill"></div></div>`; metasContainer.appendChild(metaElement); }); }
        
        function updateAtendimentoProgress() {
            const currentValue = parseInt(atendimentosInput.value) || 0;
            let highestAchieved = null;
            metas.forEach(meta => { const percent = Math.min(100, (currentValue / meta.target) * 100); const fill = document.getElementById(`meta${meta.id}-fill`); const percentText = document.getElementById(`meta${meta.id}-percent`); fill.style.width = `${percent}%`; percentText.textContent = `${Math.floor(percent)}%`; if (percent >= 100) { fill.classList.add('completed'); highestAchieved = meta; } else { fill.classList.remove('completed'); } });
            if (!highestAchieved) { const faltam = metas[0].target - currentValue; summaryText.innerHTML = `Faltam <strong>${faltam > 0 ? faltam : 0}</strong> atendimentos para a Faixa 1.`; summaryText.className = 'summary-box'; } else { const nextMetaIndex = metas.findIndex(m => m.id === highestAchieved.id) + 1; if (nextMetaIndex < metas.length) { const nextMeta = metas[nextMetaIndex]; const faltam = nextMeta.target - currentValue; summaryText.innerHTML = `Parab√©ns! Atingido: <strong>Faixa ${highestAchieved.id} (R$ ${highestAchieved.reward})</strong>. Faltam <strong>${faltam > 0 ? faltam : 0}</strong> para a pr√≥xima!`; summaryText.className = 'summary-box completed'; } else { summaryText.innerHTML = `INCR√çVEL! üèÜ Meta m√°xima de <strong>R$ ${highestAchieved.reward}</strong> atingida!`; summaryText.className = 'summary-box completed'; } }
        }

        function loadCounters() {
            const today = new Date().toLocaleDateString();
            const lastDate = localStorage.getItem('lastCountDate');
            let dailyCount = 0;
            
            if (today !== lastDate) {
                localStorage.setItem('dailyAtendimentosCount', '0');
                localStorage.setItem('lastCountDate', today);
            } else {
                dailyCount = parseInt(localStorage.getItem('dailyAtendimentosCount')) || 0;
            }

            const monthlyBase = parseInt(localStorage.getItem('monthlyAtendimentosBase')) || 0;
            atendimentosInput.value = monthlyBase + dailyCount;
            dailyCountDisplay.textContent = dailyCount;
            updateAtendimentoProgress();
        }

        dailyIncrementButton.addEventListener('click', () => {
            let dailyCount = parseInt(localStorage.getItem('dailyAtendimentosCount')) || 0;
            dailyCount++;
            localStorage.setItem('dailyAtendimentosCount', dailyCount);
            loadCounters(); // Recarrega e recalcula tudo
        });

        saveTotalButton.addEventListener('click', () => {
            const totalValue = parseInt(atendimentosInput.value) || 0;
            localStorage.setItem('monthlyAtendimentosBase', totalValue);
            localStorage.setItem('dailyAtendimentosCount', '0');
            saveTotalButton.textContent = 'Salvo!';
            setTimeout(() => { saveTotalButton.textContent = 'Salvar Total e Zerar Di√°rio'; }, 1500);
            loadCounters(); // Recarrega e recalcula tudo
        });

        atendimentosInput.addEventListener('input', updateAtendimentoProgress);
        
        renderAtendimentoMetas();
        loadCounters();

        // --- L√ìGICA GEN√âRICA PARA FAIXAS (CSAT e AVALIADAS) ---
        function setupTierTracker(inputId, containerId, tiers, storageKey) { /* ...c√≥digo da fun√ß√£o... */ }
        function setupTierTracker(inputId, containerId, tiers, storageKey) { const input = document.getElementById(inputId); const container = document.getElementById(containerId); if (!input || !container) return; container.innerHTML = ''; tiers.forEach(tier => { const faixaEl = document.createElement('div'); faixaEl.className = 'faixa-item'; faixaEl.dataset.tierMin = tier.min; faixaEl.textContent = tier.label; container.appendChild(faixaEl); }); const faixas = container.querySelectorAll('.faixa-item'); function update() { const value = parseFloat(input.value) || 0; localStorage.setItem(storageKey, value); let achievedTierMin = -1; tiers.forEach(tier => { if (value >= tier.min && value <= tier.max) { achievedTierMin = tier.min; } }); faixas.forEach(faixa => { if (parseInt(faixa.dataset.tierMin) === achievedTierMin) { faixa.classList.add('achieved'); } else { faixa.classList.remove('achieved'); } }); } const savedValue = localStorage.getItem(storageKey); if (savedValue) { input.value = savedValue; } update(); input.addEventListener('input', update); }
        const csatTiers = [ { label: 'Faixa 1 (60-69%)', min: 60, max: 69.9 }, { label: 'Faixa 2 (70-79%)', min: 70, max: 79.9 }, { label: 'Faixa 3 (80-89%)', min: 80, max: 89.9 }, { label: 'Faixa 4 (90-100%)', min: 90, max: 100 } ];
        setupTierTracker('csatInput', 'csatFaixas', csatTiers, 'csatValue');
        const avaliadasTiers = [ { label: 'Faixa 1 (21-29%)', min: 21, max: 29.9 }, { label: 'Faixa 2 (30-39%)', min: 30, max: 39.9 }, { label: 'Faixa 3 (40-49%)', min: 40, max: 49.9 }, { label: 'Faixa 4 (+50%)', min: 50, max: Infinity } ];
        setupTierTracker('avaliadasInput', 'avaliadasFaixas', avaliadasTiers, 'avaliadasValue');
    }
});
    </script>

    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./service-worker.js').then(registration => {
                    console.log('ServiceWorker registrado com sucesso: ', registration.scope);
                }, err => {
                    console.log('Registro do ServiceWorker falhou: ', err);
                });
            });
        }
    </script>
</body>
</html>